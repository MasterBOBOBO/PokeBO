<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¯¶å¯å¤¢ã„…ã„†ã„‡å¤§å†’éšª V4 (å«è²èª¿)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: #f0f8ff;
            font-family: system-ui, "Microsoft JhengHei", sans-serif;
            touch-action: none;
            height: 100vh; width: 100vw;
        }

        /* --- ç•«é¢åˆ‡æ›æ§åˆ¶ --- */
        .view {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: none; /* é è¨­éš±è— */
            flex-direction: column;
        }
        .view.active { display: flex; }

        /* --- 1. é¸å–®é é¢ (Map) --- */
        #menu-view {
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            overflow-y: auto; /* å…è¨±å‚ç›´æ²å‹• */
            -webkit-overflow-scrolling: touch;
        }

        .map-header {
            padding: 20px;
            text-align: center;
            background: rgba(255,255,255,0.95);
            position: sticky; top: 0; z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .map-title {
            color: #2a75bb; margin: 0; font-size: 1.5rem;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* ä¸€æ’ 4 å€‹ */
            gap: 15px;
            padding: 20px;
            padding-bottom: 80px; /* åº•éƒ¨ç•™ç™½å¤šä¸€é» */
        }

        .level-btn {
            aspect-ratio: 1; /* æ­£æ–¹å½¢ */
            border: none;
            border-radius: 15px;
            font-size: 2.5rem;
            font-family: "KaiTi", "BiauKai", serif;
            color: white;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.1s;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            position: relative;
        }
        .level-btn:active { transform: translateY(5px); box-shadow: none; }

        /* é¡è‰²é¡åˆ¥ */
        .bg-blue { background-color: #5D9CEC; }
        .bg-pink { background-color: #F08080; }
        .bg-green { background-color: #87D37C; }
        .bg-orange { background-color: #F4A460; }
        /* æ–°å¢ï¼šç´«è‰²çµ¦è²èª¿ç”¨ */
        .bg-purple { background-color: #9b59b6; border: 2px solid #8e44ad; } 
        
        /* ç ´é—œæ¨™è¨˜ */
        .cleared::after {
            content: 'â˜…';
            position: absolute;
            font-size: 1.5rem;
            color: gold;
            text-shadow: 0 0 3px black;
            right: 5px; bottom: 5px;
        }

        /* --- 2. éŠæˆ²é é¢ (Game) --- */
        #game-container {
            flex-grow: 1;
            margin: 10px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
            overflow: hidden;
            border: 4px solid #FFCB05;
            position: relative;
        }

        header {
            height: 50px; background: #FFCB05;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; font-weight: bold; color: #2a75bb;
        }
        
        #back-btn {
            background: white; border: 2px solid #2a75bb;
            border-radius: 20px; padding: 5px 15px;
            font-weight: bold; cursor: pointer;
        }

        #canvas-wrapper {
            position: relative; flex-grow: 1; width: 100%;
            background: radial-gradient(#fafafa 15%, transparent 16%) 0 0,
                        radial-gradient(#fafafa 15%, transparent 16%) 8px 8px;
            background-size: 16px 16px;
        }

        #watermark {
            position: absolute;
            font-size: min(50vh, 50vw);
            color: #e0e0e0; font-weight: 900;
            pointer-events: none; user-select: none;
            top: 50%; left: 50%; transform: translate(-50%, -55%);
            font-family: "KaiTi", "BiauKai", serif;
        }

        canvas { position: absolute; top: 0; left: 0; }

        .controls {
            height: 80px; display: flex; justify-content: center;
            gap: 20px; align-items: center; background: #fff; border-top: 1px solid #eee;
        }
        .btn {
            border: none; border-radius: 50px; padding: 10px 25px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        #clear-btn { background-color: #ff5e5e; color: white; }
        #catch-btn { background-color: #3b4cca; color: white; }

        /* çå‹µè¦–çª— */
        #modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 999; text-align: center; color: white;
        }
        .reward-img {
            font-size: 100px; background: white; border-radius: 50%;
            width: 140px; height: 140px; line-height: 140px;
            margin-bottom: 20px; border: 5px solid gold;
        }

    </style>
</head>
<body>

    <div id="menu-view" class="view active">
        <div class="map-header">
            <h1 class="map-title">æ³¨éŸ³å¤§å†’éšª</h1>
            <small style="color:#666">é»é¸ä¸€å€‹ç¬¦è™Ÿé–‹å§‹ï¼</small>
        </div>
        <div class="grid-container" id="level-grid">
            </div>
    </div>

    <div id="game-view" class="view">
        <div id="game-container">
            <header>
                <button id="back-btn">â† å›åœ°åœ–</button>
                <span id="current-title">ç·´ç¿’</span>
                <span style="width: 50px;"></span> 
            </header>

            <div id="canvas-wrapper">
                <div id="watermark"></div>
                <canvas id="drawCanvas"></canvas>
            </div>

            <div class="controls">
                <button id="clear-btn" class="btn">æ©¡çš®æ“¦</button>
                <button id="catch-btn" class="btn">ä¸Ÿå‡ºå¯¶è²çƒï¼</button>
            </div>

            <div id="modal">
                <div class="reward-img" id="reward-icon"></div>
                <h2 style="font-size: 2rem; margin: 10px;">æˆåŠŸï¼</h2>
                <p id="reward-text" style="font-size: 1.5rem; color: #FFCB05;"></p>
                <button class="btn" onclick="goBackToMenu()" style="background: gold; color: black; margin-top: 30px;">
                    ä¸‹ä¸€é—œ â†’
                </button>
            </div>
        </div>
    </div>

<script>
    // --- è³‡æ–™è¨­å®šå€ ---
    // æ ¼å¼ï¼š[ç¬¦è™Ÿ, é¡è‰²é¡åˆ¥, æè¿°/å¯¶å¯å¤¢, åœ–ç¤º]
    // é¡è‰²: blue, pink, green, orange, purple(è²èª¿)
    const bpmData = [
        // ã„…ã„†ã„‡
        ['ã„…', 'blue', 'å·´å¤§è¶', 'ğŸ¦‹'], ['ã„†', 'blue', 'çš®å¡ä¸˜', 'âš¡'], ['ã„‡', 'blue', 'å–µå–µ', 'ğŸ±'], ['ã„ˆ', 'blue', 'é³³ç‹', 'ğŸ¦…'],
        ['ã„‰', 'pink', 'å‘†å‘†ç¸', 'ğŸ¦›'], ['ã„Š', 'pink', 'åœŸå°é¾œ', 'ğŸ¢'], ['ã„‹', 'pink', 'å°¼å¤šç‹', 'ğŸ¦'], ['ã„Œ', 'pink', 'æ‹‰æ™®æ‹‰æ–¯', 'ğŸ¦•'],
        ['ã„', 'green', 'å›ºæ‹‰å¤š', 'ğŸ¦–'], ['ã„', 'green', 'å¡æ¯”ç¸', 'ğŸ§¸'], ['ã„', 'green', 'ç«æé¾', 'ğŸ”¥'],
        ['ã„', 'blue', 'å‚‘å°¼é¾œ', 'ğŸ¢'], ['ã„‘', 'blue', 'æ•²éŸ³çŒ´', 'ğŸ’'], ['ã„’', 'blue', 'å¸ç›¤é­”å¶', 'ğŸ¤¡'],
        ['ã„“', 'pink', 'å“²çˆ¾å°¼äºæ–¯', 'ğŸ¦Œ'], ['ã„”', 'pink', 'è¶…å¤¢', 'ğŸ‘½'], ['ã„•', 'pink', 'æ°´ç®­é¾œ', 'ğŸ¢'], ['ã„–', 'pink', 'çƒˆç©ºå', 'ğŸ‰'],
        ['ã„—', 'green', 'ç›´è¡ç†Š', 'ğŸ¦¡'], ['ã„˜', 'green', 'è‰è‹—é¾œ', 'ğŸŒ¿'], ['ã„™', 'green', 'ç´¢çˆ¾è¿¦é›·æ­', 'ğŸ¦'],
        ['ã„§', 'blue', 'ä¼Šå¸ƒ', 'ğŸ¦Š'], ['ã„¨', 'blue', 'çƒé¾œ', 'ğŸ¢'], ['ã„©', 'blue', 'åœ“é™¸é¯Š', 'ğŸ¦ˆ'],
        ['ã„š', 'pink', 'é˜¿æŸè›‡', 'ğŸ'], ['ã„›', 'pink', 'æ­è·¯æ™®', 'ğŸ'], ['ã„œ', 'pink', 'æƒ¡é£Ÿå¤§ç‹', 'ğŸ‘¾'], ['ã„', 'pink', 'æ¤°è›‹æ¨¹', 'ğŸŒ´'],
        ['ã„', 'green', 'æ„›ç®¡ä¾', 'ğŸˆ'], ['ã„Ÿ', 'green', 'Aipom(é•·å°¾æ€ªæ‰‹)', 'ğŸ’'], ['ã„ ', 'green', 'å‚²éª¨ç‡•', 'ğŸ¦'], ['ã„¡', 'green', 'æ­å“ˆé‚£', 'ğŸŒ¸'],
        ['ã„¢', 'blue', 'å®‰ç“¢èŸ²', 'ğŸ'], ['ã„£', 'blue', 'æ©æ²›', 'ğŸ§'], ['ã„¤', 'blue', 'æ˜‚', 'ğŸº'], ['ã„¥', 'blue', 'è€¿é¬¼', 'ğŸ‘»'],
        ['ã„¦', 'pink', 'äºŒ', '2ï¸âƒ£'],
        
        // --- è²èª¿ç·´ç¿’å€ (æ–°å¢åœ¨é€™è£¡) ---
        ['Ë‰', 'purple', 'ä¸€è² (å¹³å¹³çš„)', 'â–'],
        ['ËŠ', 'purple', 'äºŒè² (å¾€ä¸Šé£›)', 'âœˆï¸'],
        ['Ë‡', 'purple', 'ä¸‰è² (æ‰“å‹¾å‹¾)', 'âœ…'],
        ['Ë‹', 'purple', 'å››è² (æºœæ»‘æ¢¯)', 'â†˜ï¸'],
        ['Ë™', 'purple', 'è¼•è² (é»ä¸€ä¸‹)', 'â€¢']
    ];

    // --- ç³»çµ±è®Šæ•¸ ---
    let currentLevelIndex = 0;
    let synth = window.speechSynthesis;
    let canvas = document.getElementById('drawCanvas');
    let ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0, lastY = 0;

    // --- 1. åˆå§‹åŒ–é¸å–® ---
    function initMenu() {
        const grid = document.getElementById('level-grid');
        grid.innerHTML = '';
        
        bpmData.forEach((item, index) => {
            const btn = document.createElement('button');
            btn.className = `level-btn bg-${item[1]}`;
            
            // è™•ç†è¼•è²é¡¯ç¤ºä½ç½®ï¼Œè®“å®ƒçœ‹èµ·ä¾†ç½®ä¸­ä¸€é»
            if(item[0] === 'Ë™') {
                 btn.innerHTML = '<span style="position:relative; top:-5px;">Ë™</span>';
            } else {
                 btn.innerText = item[0];
            }

            btn.onclick = () => startGame(index);
            grid.appendChild(btn);
        });
    }

    // --- 2. éŠæˆ²æµç¨‹æ§åˆ¶ ---
    function startGame(index) {
        currentLevelIndex = index;
        const data = bpmData[index];
        
        document.getElementById('menu-view').classList.remove('active');
        document.getElementById('game-view').classList.add('active');
        
        // æ›´æ–°éŠæˆ²å…§å®¹
        document.getElementById('current-title').innerText = `ç·´ç¿’ï¼š${data[0]}`;
        document.getElementById('watermark').innerText = data[0];
        document.getElementById('reward-icon').innerText = data[3];
        
        // åˆ¤æ–·é¡¯ç¤ºæ–‡å­—
        let rewardText = "";
        let speakText = "";
        
        // å¦‚æœæ˜¯è²èª¿ (ç´«è‰²)ï¼ŒèªéŸ³é‚è¼¯ç¨å¾®ä¸åŒ
        if (data[1] === 'purple') {
            rewardText = `${data[0]} - ${data[2]}`;
            // ç‚ºäº†è®“èªéŸ³å¥½è½ä¸€é»ï¼Œå»æ‰æ‹¬è™Ÿè£¡çš„å­—åªå”¸å‰åŠæ®µ
            let simpleName = data[2].split(' ')[0]; 
            speakText = `${simpleName}ï¼Œ${simpleName}çš„${data[0]}`;
        } else {
            rewardText = `${data[0]} - ${data[2]}`;
            speakText = `${data[0]}ï¼Œ${data[2]}çš„${data[0]}`;
        }

        document.getElementById('reward-text').innerText = rewardText;
        
        // é‡ç½®ç•«å¸ƒ
        setTimeout(resizeCanvas, 100);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('modal').style.display = 'none';

        speak(speakText);
    }

    function goBackToMenu() {
        document.getElementById('game-view').classList.remove('active');
        document.getElementById('menu-view').classList.add('active');
        document.getElementById('modal').style.display = 'none';
        
        const grid = document.getElementById('level-grid');
        if(grid.children[currentLevelIndex]) {
            grid.children[currentLevelIndex].classList.add('cleared');
        }
    }

    // --- 3. ç¹ªåœ–é‚è¼¯ ---
    function resizeCanvas() {
        const wrapper = document.getElementById('canvas-wrapper');
        const rect = wrapper.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        
        // è²èª¿ç”¨ç´«è‰²ç­†ï¼Œå…¶ä»–ç”¨è—è‰²ç­†
        const data = bpmData[currentLevelIndex];
        ctx.strokeStyle = (data[1] === 'purple') ? '#8e44ad' : '#2a75bb'; 
        
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = 15; 
    }

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;
        if (e.touches && e.touches.length > 0) {
            clientX = e.touches[0].clientX; clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX; clientY = e.clientY;
        }
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function startDrawing(e) {
        e.preventDefault(); isDrawing = true;
        const pos = getPos(e);
        lastX = pos.x; lastY = pos.y;
        ctx.beginPath();
        ctx.arc(lastX, lastY, ctx.lineWidth / 2, 0, Math.PI * 2);
        ctx.fillStyle = ctx.strokeStyle; ctx.fill(); ctx.beginPath();
    }

    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        const pos = getPos(e);
        ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(pos.x, pos.y); ctx.stroke();
        lastX = pos.x; lastY = pos.y;
    }

    function stopDrawing() { isDrawing = false; ctx.beginPath(); }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing, {passive: false});
    canvas.addEventListener('touchmove', draw, {passive: false});
    canvas.addEventListener('touchend', stopDrawing);

    // --- 4. æŒ‰éˆ•äº‹ä»¶ ---
    document.getElementById('back-btn').addEventListener('click', goBackToMenu);
    
    document.getElementById('clear-btn').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        speak("åŠ æ²¹ï¼Œå†è©¦ä¸€æ¬¡");
    });

    document.getElementById('catch-btn').addEventListener('click', () => {
        const data = bpmData[currentLevelIndex];
        document.getElementById('modal').style.display = 'flex';
        
        // è²èª¿çš„çå‹µèªéŸ³
        if (data[1] === 'purple') {
            let simpleName = data[2].split(' ')[0];
            speak(`å¥½å²å®³ï¼å­¸æœƒäº†${simpleName}ï¼`);
        } else {
            speak(`å¤ªæ£’äº†ï¼æ”¶æœ${data[2]}ï¼`);
        }
    });

    // --- 5. èªéŸ³èˆ‡å•Ÿå‹• ---
    function speak(text) {
        if (!synth) return;
        synth.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-TW'; utterance.rate = 1; utterance.pitch = 1.2;
        synth.speak(utterance);
    }

    window.onload = function() {
        initMenu();
        window.addEventListener('resize', resizeCanvas);
    };

</script>
</body>
</html>