<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¯¶å¯å¤¢ã„…ã„†ã„‡å¤§å†’éšª V2</title>
    <style>
        /* 1. åŸºç¤è¨­å®šï¼šç¦æ­¢é é¢æ»‘å‹•ï¼Œæ»¿ç‰ˆé¡¯ç¤º */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f8ff;
            font-family: system-ui, -apple-system, "Microsoft JhengHei", sans-serif;
            touch-action: none; /* é—œéµï¼šç¦æ­¢ç€è¦½å™¨é è¨­çš„è§¸æ§ç¸®æ”¾/æ»‘å‹• */
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        /* 2. éŠæˆ²ä¸»å®¹å™¨ */
        #game-container {
            position: relative;
            width: 95vw;
            height: 95vh;
            margin-top: 2.5vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 4px solid #FFCB05; /* çš®å¡ä¸˜é»ƒé‚Šæ¡† */
        }

        /* 3. æ¨™é¡Œå€ */
        header {
            height: 60px;
            background: #FFCB05;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2a75bb;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        /* 4. ç¹ªåœ–å€ (æœ€é‡è¦çš„åœ°æ–¹) */
        #canvas-wrapper {
            position: relative;
            flex-grow: 1; /* ä½”æ»¿å‰©é¤˜ç©ºé–“ */
            width: 100%;
            background: radial-gradient(#fafafa 15%, transparent 16%) 0 0,
                        radial-gradient(#fafafa 15%, transparent 16%) 8px 8px;
            background-size: 16px 16px; /* é»é»èƒŒæ™¯ç´™è³ªæ„Ÿ */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* èƒŒæ™¯æµ®æ°´å° (ã„…) */
        #watermark {
            position: absolute;
            font-size: min(60vh, 60vw); /* è‡ªå‹•èª¿æ•´å¤§å° */
            color: #e0e0e0;
            font-weight: 900;
            pointer-events: none; /* è®“é»æ“Šç©¿é€ */
            user-select: none;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -55%);
        }

        /* ç•«å¸ƒæœ¬é«” */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            touch-action: none; /*å†ä¸€æ¬¡ç¢ºä¿ä¸å¹²æ“¾ */
        }

        /* 5. æŒ‰éˆ•å€ */
        .controls {
            height: 80px;
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            background: #fff;
            border-top: 1px solid #eee;
            flex-shrink: 0;
        }

        .btn {
            border: none;
            border-radius: 50px;
            padding: 10px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: all 0.1s;
        }

        .btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        #clear-btn { background-color: #ff5e5e; color: white; }
        #catch-btn { background-color: #3b4cca; color: white; }

        /* 6. çå‹µè¦–çª— */
        #modal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            text-align: center;
            color: white;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .reward-img {
            font-size: 120px;
            background: white;
            border-radius: 50%;
            width: 150px;
            height: 150px;
            line-height: 150px;
            margin-bottom: 20px;
            border: 5px solid gold;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

    </style>
</head>
<body>

<div id="game-container">
    <header>
        <span>âš¡ è·Ÿè‘—çš®å¡ä¸˜å­¸ï¼šã„…</span>
    </header>

    <div id="canvas-wrapper">
        <div id="watermark">ã„…</div>
        <canvas id="drawCanvas"></canvas>
    </div>

    <div class="controls">
        <button id="clear-btn" class="btn">æ©¡çš®æ“¦</button>
        <button id="catch-btn" class="btn">ä¸Ÿå‡ºå¯¶è²çƒï¼</button>
    </div>

    <div id="modal">
        <div class="reward-img">ğŸ¦‹</div>
        <h2 style="font-size: 2rem; margin: 10px;">æ”¶æœæˆåŠŸï¼</h2>
        <p style="font-size: 1.5rem; color: #FFCB05;">æ˜¯ã€Œå·´å¤§è¶ã€ï¼</p>
        <button class="btn" onclick="resetGame()" style="background: gold; color: black; margin-top: 30px; font-size: 1.5rem;">å†ä¸€æ¬¡ï¼</button>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒé‚è¼¯å€ ---
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    const wrapper = document.getElementById('canvas-wrapper');
    const modal = document.getElementById('modal');
    
    // è¨­å®šç•«ç­†ç‹€æ…‹
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    
    // èªéŸ³åˆæˆåˆå§‹åŒ–
    let synth = window.speechSynthesis;
    let hasInteracted = false; // è¿½è¹¤æ˜¯å¦å·²ç¶“é»æ“Šéè¢å¹•

    // 1. åˆå§‹åŒ–ç•«å¸ƒå°ºå¯¸ (ä¿®æ­£æ¨¡ç³Šå•é¡Œ)
    function resizeCanvas() {
        const rect = wrapper.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        
        // è¨­å®šç•«ç­†æ¨£å¼
        ctx.strokeStyle = '#2a75bb'; 
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = 12; 
    }
    
    // ç›£è½è¦–çª—æ”¹è®Šï¼Œä¿æŒç•«å¸ƒæ­£ç¢º
    window.addEventListener('resize', resizeCanvas);
    setTimeout(resizeCanvas, 50); // ç¢ºä¿è¼‰å…¥å¾ŒåŸ·è¡Œ

    // 2. å–å¾—æ­£ç¢ºåº§æ¨™ (æ”¯æ´æ»‘é¼ èˆ‡è§¸æ§)
    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;
        
        if (e.touches && e.touches.length > 0) {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }
        
        return {
            x: clientX - rect.left,
            y: clientY - rect.top
        };
    }

    // 3. ç¹ªåœ–äº‹ä»¶è™•ç†
    function startDrawing(e) {
        e.preventDefault(); // é˜²æ­¢ç•«é¢æ»¾å‹•
        isDrawing = true;
        const pos = getPos(e);
        lastX = pos.x;
        lastY = pos.y;
        
        // ç•«ä¸€å€‹é» (è™•ç†å–®é»)
        ctx.beginPath();
        ctx.arc(lastX, lastY, ctx.lineWidth / 2, 0, Math.PI * 2);
        ctx.fillStyle = ctx.strokeStyle;
        ctx.fill();
        ctx.beginPath(); // é‡æ–°é–‹å§‹è·¯å¾‘
    }

    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault(); // çµ•å°ç¦æ­¢æ»¾å‹•
        const pos = getPos(e);
        
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        
        lastX = pos.x;
        lastY = pos.y;
    }

    function stopDrawing() {
        isDrawing = false;
        ctx.beginPath(); // æ–·é–‹è·¯å¾‘ï¼Œé¿å…é€£ç·š
    }

    // ç¶å®šäº‹ä»¶ (æ”¯æ´é›»è…¦èˆ‡æ‰‹æ©Ÿ)
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    canvas.addEventListener('touchstart', startDrawing, {passive: false});
    canvas.addEventListener('touchmove', draw, {passive: false});
    canvas.addEventListener('touchend', stopDrawing);

    // 4. æŒ‰éˆ•åŠŸèƒ½
    document.getElementById('clear-btn').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        speak("å†è©¦ä¸€æ¬¡ï¼");
    });

    document.getElementById('catch-btn').addEventListener('click', () => {
        // è§£é–è²éŸ³ (å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é»æ“Š)
        if (!hasInteracted) { hasInteracted = true; }
        
        // ç°¡å–®åˆ¤å®šæœ‰æ²’æœ‰ç•«ç•« (æª¢æŸ¥ä¸­å¿ƒé»æœ‰æ²’æœ‰é¡è‰²)
        // é€™è£¡ç‚ºäº†è®“å°æœ‹å‹é–‹å¿ƒï¼Œä¸åšåš´æ ¼æª¢æŸ¥ï¼Œç›´æ¥çµ¦çå‹µ
        modal.style.display = 'flex';
        speak("æ­å–œï¼æŠ“åˆ°äº†ï¼ã„…ï¼Œå·´å¤§è¶ï¼");
    });

    function resetGame() {
        modal.style.display = 'none';
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        speak("è·Ÿè‘—çš®å¡ä¸˜ï¼Œå¯«ã„…ï¼");
    }
    
    // è®“å…¨åŸŸä¹Ÿèƒ½å‘¼å« (çµ¦ HTML onclick ç”¨)
    window.resetGame = resetGame;

    // 5. èªéŸ³åŠŸèƒ½ (å¼·åŒ–ç›¸å®¹æ€§)
    function speak(text) {
        if (!synth) return;
        
        // å–æ¶ˆä¸Šä¸€å¥
        synth.cancel();
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-TW'; 
        utterance.rate = 1; 
        utterance.pitch = 1.2; 
        
        // å˜—è©¦æ’­æ”¾
        synth.speak(utterance);
    }

</script>
</body>
</html>